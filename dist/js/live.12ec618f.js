(function(e){function t(t){for(var a,i,o=t[0],u=t[1],s=t[2],l=0,d=[];l<o.length;l++)i=o[l],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(e[a]=u[a]);f&&f(t);while(d.length)d.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],a=!0,o=1;o<n.length;o++){var u=n[o];0!==r[u]&&(a=!1)}a&&(c.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={live:0},c=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=t,o=o.slice();for(var s=0;s<o.length;s++)t(o[s]);var f=u;c.push([1,"chunk-common","chunk-live-vendors"]),n()})({1:function(e,t,n){e.exports=n("bf33")},2:function(e,t){},"2c9b":function(e,t,n){"use strict";n("39ab")},3:function(e,t){},"39ab":function(e,t,n){},"62b7":function(e,t,n){},"7fcf":function(e,t,n){"use strict";n("62b7")},"835c":function(e,t,n){"use strict";n("9fad")},"9fad":function(e,t,n){},bf33:function(e,t,n){"use strict";n.r(t);n("e623"),n("e379"),n("5dc8"),n("37e1"),n("5595");var a=n("7a23");function r(e,t,n,r,c,i){var o=Object(a["q"])("danmaku-item"),u=Object(a["q"])("live");return r.errMsg?(Object(a["k"])(),Object(a["d"])(o,{key:0,type:"info",message:r.errMsg},null,8,["message"])):r.ready?(Object(a["k"])(),Object(a["d"])(u,Object(a["g"])({key:1},r.props),null,16)):Object(a["e"])("",!0)}n("18a5");var c=n("f6cc"),i=(n("d3b7"),n("ac1f"),n("5319"),n("72bf")),o=!0,u=function(e){return o=e},s=function(e){return fetch(e).then((function(e){return e.json()}))},f=function(e){return fetch("https://json2jsonp.com/?".concat(Object(i["stringify"])({url:e,callback:"_"}))).then((function(e){return e.text()})).then((function(e){return JSON.parse(e.replace(/^_\((.*)\)$/,"$1"))}))},l=function(e){return o?s(e):f(e)},d=(n("99af"),n("4de4"),n("a630"),n("caad"),n("4ec9"),n("4fad"),n("2532"),n("3ca3"),n("1276"),n("ddb0"),n("96cf"),n("1da1")),b=n("3835"),m=n("4416"),p=n.n(m),j=n("3bb8"),v=n.n(j),O=n("b047"),g=n.n(O),h=n("5d2d"),k=function(){return Math.floor(Date.now()/864e5)},y={method:"false",expireDay:7},w=function(e){return Object.assign(y,e)},x=function(e){switch(y.method){case"imjad":return s("https://api.imjad.cn/bilibili/v2/?get=space&vmid=".concat(e,"&pagesize=1")).then((function(e){var t,n;return null===(t=e.data)||void 0===t||null===(n=t.card)||void 0===n?void 0:n.face}));default:return l("https://api.bilibili.com/x/space/acc/info?mid=".concat(e)).then((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.face}))}},S=function(e){var t=Object(b["a"])(e,2),n=t[0],a=t[1];a||(a="member/noface.jpg");var r=p()(a.split(".")),c="https://i".concat(n,".hdslb.com/bfs/face/").concat(a);return"gif"===r?[[c,0]]:[["".concat(c,"_48x48.").concat(r),2e3],[c,5e3]]},L=function(e){var t=Object(b["a"])(e,3),n=t[2];return!n||k()-n<=y.expireDay},R=new Map(Object.entries(Object(h["a"])("face",{})).filter((function(e){var t=Object(b["a"])(e,2),n=t[1];return!L(n)}))),_=g()((function(){return Object(h["b"])("face",v()(Array.from(R)))}),5e3,{maxWait:5e3}),E=function(e,t){var n;if(t){var a=parseInt(null===(n=/\/\/i(\d+)\./.exec(t))||void 0===n?void 0:n[1])||0,r=p()(t.split("/")),c=r.includes("noface")?[0,null,k()]:[a,r,k()];return R.set(e,c),_(),c}},T=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=R.get(t),!n||L(n)){e.next=3;break}return e.abrupt("return",S(n));case 3:return e.t0=S,e.t1=E,e.t2=t,e.next=8,x(t);case 8:return e.t3=e.sent,e.t4=(0,e.t1)(e.t2,e.t3),e.abrupt("return",(0,e.t0)(e.t4));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M={id:"live"};function P(e,t,n,r,c,i){var o=Object(a["q"])("danmaku-list");return Object(a["k"])(),Object(a["d"])("div",M,[r.props.giftPin?(Object(a["k"])(),Object(a["d"])(o,Object(a["g"])({key:0,ref:"giftPinList"},r.props,{"gift-show-face":r.giftShowFace,"is-gift-list":!0}),null,16,["gift-show-face"])):Object(a["e"])("",!0),Object(a["f"])(o,Object(a["g"])({ref:"danmakuList"},r.props),null,16)])}var D=n("5530"),N=n("96ac"),A={key:0,class:"danmaku-list-pinned",ref:"danmakuListRef"},I={class:"danmaku-list hidden"},F={class:"danmaku-list absolute",ref:"giftListRef"},G={key:1,class:"danmaku-list",ref:"danmakuListRef"},C={key:0,class:"danmaku-list-placeholder"};function B(e,t,n,r,c,i){var o=Object(a["q"])("danmaku-item");return n.isGiftList?(Object(a["k"])(),Object(a["d"])("div",A,[Object(a["f"])("div",I,[(Object(a["k"])(!0),Object(a["d"])(a["a"],null,Object(a["o"])(e.giftPin,(function(e){return Object(a["k"])(),Object(a["d"])(o,{key:e,"show-face":n.giftShowFace,type:"gift",uname:"某人",giftName:"礼物",num:e},null,8,["show-face","num"])})),128))]),Object(a["f"])("div",F,[(Object(a["k"])(!0),Object(a["d"])(a["a"],null,Object(a["o"])(r.danmakuList,(function(e){return Object(a["k"])(),Object(a["d"])(o,Object(a["g"])({key:e.key},e.props,{hidden:e.hidden,ref:function(t){return e.el=t}}),null,16,["hidden"])})),128))],512)],512)):(Object(a["k"])(),Object(a["d"])("div",G,["bottom"===e.display?(Object(a["k"])(),Object(a["d"])("div",C)):Object(a["e"])("",!0),(Object(a["k"])(!0),Object(a["d"])(a["a"],null,Object(a["o"])(r.danmakuList,(function(e){return Object(a["k"])(),Object(a["d"])(o,Object(a["g"])({key:e.key},e.props,{hidden:e.hidden,ref:function(t){return e.el=t}}),null,16,["hidden"])})),128))],512))}n("7db0"),n("c740"),n("4160"),n("d81d"),n("a434"),n("b64b"),n("159b");var H=n("443d"),q=n.n(H),J=n("ec26"),U=n("53ca"),z=n("b85c"),$=function(e,t){return new Promise((function(n,a){var r=0,c=new XMLHttpRequest,i=setTimeout((function(){c.abort()}),1e4),o=t?setTimeout((function(){0===r&&c.abort()}),t):null;c.open("GET",e,!0),c.onprogress=function(e){e.lengthComputable&&(r=e.loaded/e.total)},c.onload=function(){clearTimeout(o),clearTimeout(i),n(e)},c.onerror=a,c.onabort=a,c.send()}))},W=function(){var e=Object(d["a"])(regeneratorRuntime.mark((function e(t){var n,a,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=Object(z["a"])(t),e.prev=1,r=regeneratorRuntime.mark((function e(){var t,n,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=Object(b["a"])(a.value,2),n=t[0],r=t[1],e.next=3,$(n,r).catch((function(){console.warn("Timeout",n)}));case 3:if(c=e.sent,!c){e.next=6;break}return e.abrupt("return",{v:c});case 6:case"end":return e.stop()}}),e)})),n.s();case 4:if((a=n.n()).done){e.next=11;break}return e.delegateYield(r(),"t0",6);case 6:if(c=e.t0,"object"!==Object(U["a"])(c)){e.next=9;break}return e.abrupt("return",c.v);case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e["catch"](1),n.e(e.t1);case 16:return e.prev=16,n.f(),e.finish(16);case 19:return e.abrupt("return",t[0][0]||"");case 20:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})));return function(t){return e.apply(this,arguments)}}(),K={key:1,class:"danmaku-content"},X={class:"danmaku-message"},Y={key:2,class:"danmaku-content"},Q=Object(a["f"])("span",{class:"danmaku-message"},"感谢 ",-1),V={class:"danmaku-author-name"},Z=Object(a["f"])("span",{class:"danmaku-message"}," 赠送 ",-1),ee={class:"danmaku-gift-name"},te=Object(a["f"])("span",{class:"danmaku-message"}," × ",-1),ne={class:"danmaku-gift-num"},ae={key:3,class:"danmaku-content"},re={class:"danmaku-message"};function ce(e,t,n,r,c,i){return Object(a["k"])(),Object(a["d"])("div",{class:["danmaku-item",{hidden:r.isHidden}]},[n.showFace?(Object(a["k"])(),Object(a["d"])("div",{key:0,class:"danmaku-author-face",style:{backgroundImage:n.face?"url(".concat(n.face,")"):""}},null,4)):Object(a["e"])("",!0),"message"===n.type?(Object(a["k"])(),Object(a["d"])("div",K,[Object(a["f"])("span",{class:["danmaku-author-name with-colon",{anchor:n.isAnchor,owner:n.isOwner}]},Object(a["r"])(n.uname),3),Object(a["f"])("span",X,Object(a["r"])(n.message),1)])):"gift"===n.type?(Object(a["k"])(),Object(a["d"])("div",Y,[Q,Object(a["f"])("span",V,Object(a["r"])(n.uname),1),Z,Object(a["f"])("span",ee,Object(a["r"])(n.giftName),1),te,Object(a["f"])("span",ne,Object(a["r"])(n.num),1)])):"info"===n.type?(Object(a["k"])(),Object(a["d"])("div",ae,[Object(a["f"])("span",re,Object(a["r"])(n.message),1)])):Object(a["e"])("",!0)],2)}n("a9e3");var ie={props:{type:{type:String,default:"message"},showFace:Boolean,face:String,uid:Number,uname:String,message:String,isAnchor:Boolean,isOwner:Boolean,action:String,giftName:String,num:Number,stay:Number,hidden:Boolean},setup:function(e){var t=Object(a["n"])(!1),n=Object(a["n"])(!1);if(e.stay){var r=setTimeout((function(){t.value=!0,"info"===e.type&&setTimeout((function(){return n.value=!0}),800)}),e.stay);Object(a["i"])((function(){return clearTimeout(r)}))}var c=Object(a["b"])((function(){return e.hidden||t.value}));return Object(D["a"])(Object(D["a"])({},Object(a["s"])(e)),{},{isHidden:c,needRemoved:n})}};n("835c");ie.render=ce;var oe=ie,ue=new Map,se={components:{DanmakuItem:oe},props:Object(D["a"])(Object(D["a"])({},c["d"]),{},{isGiftList:Boolean,giftShowFace:Boolean}),setup:function(e){var t=!0;Object(a["i"])((function(){return t=!1}));var n=Object(a["n"])([]),r=Object(a["n"])(null),c=Object(a["n"])(null);Object(a["j"])((function(){var e=r.value.getBoundingClientRect().top-5,t=function(){var t=n.value.findIndex((function(t){var n,a,r,c,i=null!==(n=null===(a=t.el)||void 0===a||null===(r=a.$el)||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},o=i.top,u=void 0===o?e:o,s=i.height,f=void 0===s?0:s;return u<e&&(t.hidden=!0),u+f>e&&!(null!==(c=t.el)&&void 0!==c&&c.needRemoved)}));t>0&&n.value.splice(0,t)},c=setInterval(t,100);Object(a["i"])((function(){return clearInterval(c)}))}));var i=function(){var t=Object(a["t"])(e.isGiftList?c:r);t&&(t.scrollTop=t.scrollHeight)};e.isGiftList||(Object(a["j"])((function(){return window.addEventListener("resize",i)})),Object(a["i"])((function(){return window.removeEventListener("resize",i)})));var o=[],u=function e(){var r=200,c=o.length;c>0&&(r=Math.min(r,1e3/c),n.value.push(o.shift()),Object(a["h"])(i)),t&&setTimeout(e,r)};u();var s=function(){var t=Object(d["a"])(regeneratorRuntime.mark((function t(n){var a,r,c,i,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.showFace){t.next=19;break}return t.next=3,T(n.uid);case 3:if(a=t.sent,c=a.find((function(e){var t=Object(b["a"])(e,1),n=t[0];return r=ue.get(n)}))||[""],i=Object(b["a"])(c,1),u=i[0],u){t.next=14;break}return r=W(a),ue.set(u,r),t.next=10,r;case 10:u=t.sent,ue.set(u,!0),t.next=18;break;case 14:if(!0===r){t.next=18;break}return t.next=17,r;case 17:u=t.sent;case 18:n.face=u;case 19:n.stay=n.stay||("bottom"===e.display?e.stay:0),o.push({props:n,key:Object(J["a"])(),el:null,hidden:!1});case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),f=[];if(e.limit){var l=setInterval((function(){var t=f.splice(0);t.length&&(t.length>e.limit&&(t=q()(Object.keys(t),e.limit).sort().map((function(e){return t[e]}))),t.forEach((function(e){return s(e)})))}),1e3);Object(a["i"])((function(){return clearInterval(l)}))}var m=function(e){return f.push(e)};return Object(D["a"])(Object(D["a"])({},Object(a["s"])(e)),{},{danmakuList:n,danmakuListRef:r,giftListRef:c,addDanmaku:s,addSpeedLimitDanmaku:m})}};n("7fcf");se.render=B;var fe=se,le={components:{DanmakuList:fe},props:c["d"],setup:function(e){var t=Object(a["n"])(null),n=Object(a["n"])(null),r=new Map,c=Object(a["b"])((function(){return!["false","gift"].includes(e.face)})),i=function(t){n.value.addDanmaku({type:"info",message:t,stay:e.stay||5e3})},o=function(t){e.limit?n.value.addSpeedLimitDanmaku(t):n.value.addDanmaku(t)};return Object(a["j"])((function(){console.log("正在连接直播弹幕服务器");var u=new N["KeepLiveWS"](e.room);Object(a["i"])((function(){return u.close()})),u.on("open",(function(){console.log("已连接直播弹幕服务器"),i("已连接直播弹幕服务器")})),u.on("live",(function(){console.log("已连接直播间",e.room),i("已连接直播间 ".concat(e.room))})),u.on("close",(function(){return console.log("已断开与直播弹幕服务器的连接")})),u.on("heartbeat",(function(e){return console.log("当前人气值",e)}));var s=e.giftPin?t:n;u.on("SEND_GIFT",(function(t){var n=t.data,a=n.uid,c=n.uname,i=n.action,o=n.giftName,u=n.num,f=n.face;if(E(a,f),e.giftComb){var l="".concat(a,"-").concat(o),d=r.get(l);d?r.set(l,Object(D["a"])(Object(D["a"])({},d),{},{num:d.num+u})):(r.set(l,{type:"gift",showFace:"false"!==e.face,uid:a,uname:c,action:i,giftName:o,num:u}),setTimeout((function(){s.value.addDanmaku(r.get(l)),r.delete(l)}),e.giftComb))}else s.value.addDanmaku({type:"gift",showFace:"false"!==e.face,uid:a,uname:c,action:i,giftName:o,num:u})})),u.on("DANMU_MSG",(function(t){var n=Object(b["a"])(t.info,3),a=n[1],r=Object(b["a"])(n[2],3),i=r[0],u=r[1],s=r[2],f={type:"message",showFace:c.value,uid:i,uname:u,message:a,isAnchor:i===e.anchor,isOwner:!!s};e.delay>0?setTimeout((function(){return o(f)}),1e3*e.delay):o(f)})),u.on("SUPER_CHAT_MESSAGE",(function(e){return console.log("SUPER_CHAT_MESSAGE",e)})),u.on("SUPER_CHAT_MESSAGE_JPN",(function(e){return console.log("SUPER_CHAT_MESSAGE_JPN",e)}))})),{props:e,giftShowFace:c,giftPinList:t,danmakuList:n}}};n("d3de");le.render=P;var de=le,be={components:{Live:de,DanmakuItem:oe},setup:function(){var e=function(){return window.location.reload()};window.addEventListener("hashchange",e),Object(a["i"])((function(){return window.removeEventListener("hashchange",e)}));var t=Object(a["l"])(Object(c["c"])(window.location.hash)),n="true"===t.cors;u(n),w({method:t.face,expireDay:t.faceExpireDay});var r=Object(a["n"])(!1),i=Object(a["n"])("");return l("https://api.live.bilibili.com/room_ex/v1/RoomNews/get?roomid=".concat(t.room)).then((function(e){var n=e.code,a=e.msg,c=e.data,o=c.roomid,u=c.uid;0===n?(t.room=parseInt(o),t.anchor=parseInt(u),r.value=!0):i.value=a})).catch((function(){i.value="获取房间信息失败",n&&(i.value+="，请检查是否正确禁用了浏览器的 web security 以允许直接跨域")})),{props:t,ready:r,errMsg:i}}};n("2c9b");be.render=r;var me=be;Object(a["c"])(me).mount("#app")},d133:function(e,t,n){},d3de:function(e,t,n){"use strict";n("d133")}});